{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% block content %}

<div class="container">
    <h1>{{ schedule }}</h1>
    <p>by {{ schedule.author }}</p>
    <p>{{ schedule.description }}</p>
    <p>
    <form action="{% url 'schedule_like' schedule.slug %}" method="POST" class="d-inline">
        {% csrf_token %}
        <button type="submit" name="schedule_id" value="{{ schedule.slug }}" class="btn btn-link"><i class="
                            {% if is_liked %}
                            fas
                            {% else %}
                            far
                            {% endif %}
                            fa-thumbs-up"></i></button>
    </form>
    <div class="d-inline">{{ like_count }}</div>
    </p>
    <p>
    <form action="{% url 'schedule_subscribe' schedule.slug %}" method="POST" class="d-inline">
        {% csrf_token %}
        {% if is_subscribed %}
        <button type="submit" name="schedule_id" value="{{ schedule.slug }}"
            class="btn btn-secondary">Subscribed</button>
        {% else %}
        {% csrf_token %}
        <button type="submit" name="schedule_id" value="{{ schedule.slug }}" class="btn btn-primary">Subscribe</button>
    </form>
    {% endif %}
    </p>
    <hr>
    <h2>Comments</h2>
    <!-- Creating New Comments -->
    <!-- -> Credit for crispy forms: https://github.com/Code-Institute-Solutions/blog/tree/main/12_views_part_3/01_posting_to_database -->
    <div class="col-md-4 card mb-4 mt-3">
        <div class="card-body">
            {% if user.is_authenticated %}
            <h3>Leave a comment:</h3>
            <p>Posting as: {{ user.username }}</p>
            <form action="{% url 'schedule_comment' schedule.slug %}" method="POST" style="margin-top: 1.3em;">
                {{ comment_form | crispy }}
                {% csrf_token %}
                <button id="submitButton" type="submit" class="btn btn-signup">Submit</button>
            </form>
            {% else %}
            <p>Log in to leave a comment</p>
            {% endif %}
        </div>
    </div>
    {% for comment in comments %}
    <p class="mb-0"><strong>{{ comment.commented_by }}</strong></p>
    <p>{{ comment.body }}</p>
    <p>
    <form method="post" action="{% url 'schedule_comment_delete' comment.id %}">
        {% csrf_token %}
        <input type="submit" value="Delete">
    </form>
    <form method="post" action="{% url 'schedule_comment_update' comment.id %}">
        {% csrf_token %}
        <input type="submit" value="Update">
    </form>
    </p>
    {% endfor %}
</div>

{% endblock %}